<?php
//*****************************************************************************
//*****************************************************************************
/**
 * Node Config Class
 *
 * @package         Cclark61\RPi\WS2812
 * @subpackage         Config
 * @author          Christian J. Clark
 * @copyright       Christian J. Clark
 * @link            https://github.com/cclark61/php-rpi-ws2812
 **/
//*****************************************************************************
//*****************************************************************************

namespace Cclark61\RPi\WS2812\Config;

class Node
{
    //=========================================================================
    //=========================================================================
    // Get Config
    //=========================================================================
    //=========================================================================
    public static function GetConfig($args)
    {
        //---------------------------------------------------------------------
        // Config Empty?
        //---------------------------------------------------------------------
        if (!$args) {
            return static::DefaultConfig();
        }

        //---------------------------------------------------------------------
        // Config is an array
        //---------------------------------------------------------------------
        if (is_array($args)) {
            $config = static::ValidateConfig($args);
        }
        //---------------------------------------------------------------------
        // Config index given
        //---------------------------------------------------------------------
        else {
            $index = $args;
            $config = new \phpOpenFW\Core\AppConfig();
            if (empty($config->nodes[$index])) {
                if ($index == 'default') {
                    return static::DefaultConfig();
                }
                else {
                    die("[!!] Invalid configuration index.\n");
                }
            }
            $config = static::ValidateConfig($config->nodes[$index]);
        }

        //---------------------------------------------------------------------
        // Return Config
        //---------------------------------------------------------------------
        return $config;
    }

    //=========================================================================
    //=========================================================================
    // Validate Config
    //=========================================================================
    //=========================================================================
    public static function ValidateConfig(Array $args)
    {
        //---------------------------------------------------------------------
        // Check that config is an array
        //---------------------------------------------------------------------
        if (!is_array($args)) {
            die("[!!] Node configuration must be an array.\n");
        }
        $config = $args;

        //---------------------------------------------------------------------
        // Check Host
        //---------------------------------------------------------------------
        if (empty($config['host'])) {
            die("[!!] Node host (IP address or hostname) not specified.\n");
        }

        //---------------------------------------------------------------------
        // Check Port
        //---------------------------------------------------------------------
        if (empty($config['port'])) {
            die("[!!] Node port not specified.\n");
        }

        //---------------------------------------------------------------------
        // Check number of LEDs
        //---------------------------------------------------------------------
        if (empty($config['num_leds'])) {
            die("[!!] Number of LEDs in the node was not specified.\n");
        }

        //---------------------------------------------------------------------
        // Return Config
        //---------------------------------------------------------------------
        return $config;
    }

    //=========================================================================
    //=========================================================================
    // Validate Config
    //=========================================================================
    //=========================================================================
    public static function DefaultConfig(Array $args=[])
    {
        //---------------------------------------------------------------------
        // Set Default Config
        //---------------------------------------------------------------------
        $config = [
            'index' => 'default',
            'host' => '127.0.0.1',
            'port' => 9999,
            'num_leds' => 10
        ];

        //---------------------------------------------------------------------
        // Override Config Values?
        //---------------------------------------------------------------------
        if ($args) {
            $config = array_merge($config, $args);
        }

        //---------------------------------------------------------------------
        // Return Config
        //---------------------------------------------------------------------
        return $config;
    }

}
